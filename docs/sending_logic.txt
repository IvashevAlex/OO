Логика обаботки данных и взаимодействия с БД при подготовке и отправке рассылки

Цикл проверки времени рассылки - запускает рассылку в установленное время
Запрос к базе данных - получить все данные, необходимые для рассылки
База данных:
    Таблица пользователей (WhiteList) - берем id пользователей по дате их регистрации
    Таблица рассылок (Messages) - берем текст рассылки по ее порядковому номеру
    Схема рассылки (Calendar) - берем число будних дней после регистрации пользователя
                                и получаем номер рассылки, который берём из Messages
    Таблица наборов (Settable) - таблица с одним столбцом в котором последовательно указаны
                                 даты начала обучения каждой группы. Заполнятся будет 
                                 нажатием кнопки в меню админа в день нового набора

Порядок действий:
1) Запускаем цикл по количеству записей в Settable
2) Получаем дату начала учебы первого набора
3) Запрашиваем значение следующего элемента
4) Если значение в п.3 отсутствует, то создаем диапазн с п.2 до (п.2 + 4 дня)
5) Если значение в п.3 есть, то создаем диапазон с п.2 до (п.3 - 1 день)

6) Создаем словарь и указываем в качестве ключа диапазон из п.4 или п.5
7) По диапазону из п.4 или п.5 запрашиваем в WhiteList список id пользователей
8) Записываем в словарь список, полученный в п.7
9) Проводим рассчет (сегодня - значение п.2) - число дней с начала обучени группы

10) По значению из п.9 обращаемся к Calendar и запрашиваем номер рассылки для этого дня
11) Если рассылки нет (значение None), то прерываем цикл и продолжаем с п.1
12) Если рассылка есть, то фиксируем номер данной рассылки 
13) По значению из п.12 обращаемся к Messages и получаем текст рассылки
14) Записываем текст рассылки в словарь
15) На основании словаря запускаем цикл рассылки для каждого пользователя
16) При наличии следующего цикла начать с п.1


----------------------------------------------------------------------------------------

Кнопка рассылки расположена в меню админа. Она вызывает подменю с двумя разделами
РАССЫЛКА
    БАЗА СООБЩЕНИЙ - при входе получаем сообщение о текущем числе записей в таблице
        Создать сообщение
        Просмотреть сообщение (запрос по номеру)
        Изменить сообщение (запрос по номеру и прием текста по кнопке Готово)

    КАЛЕНДАРЬ РАССЫЛОК - при входе получаем сообщение о текущем числе запланированных рассылок
        Создать рассылку
        Просмотреть рассылку (запрос по номеру)
        Изменить рассылку (запрос по номеру и прием текста по кнопке Готово)

Рассмотреть возможность скелета рассылок, когда они меют один и тот же формат, но рассылаются разным адресатам в разное время 
Неделя 38, Неделя 39, Неделя 40 и т.д.
1 неделя - пн, ср, пт 13:00
2 неделя - Вт, пт 15:00
3 неделя - Ср Пт 16:00
4 неделя - Пн, Вт, Ср, Чв в 12:00 и 18:00
5 неделя - Пн 15:00 17:00

Группа начавшая обучение на 38 неделе получит сообщения на 38,39,40,41,42
Группа начавшая обучение на 41 неделе получит сообщения на 41,42,43,44,45
